---
import BaseLayout from '../layouts/BaseLayout.astro';
import partnersData from '../data/buwatv/partners.json';

const title = "Our Partners | BuWa Digital";
const description = "Meet some of the local brands we’re proud to work with across the community.";

const hostPartners = partnersData.partners ?? [];
const communityPartners = partnersData.communityPartners ?? [];

const normalizePartnerName = (value = '') =>
  value
    .toLowerCase()
    .replace(/&/g, 'and')
    .replace(/[^a-z0-9]+/g, ' ')
    .replace(/\s+/g, ' ')
    .trim();

const uniquePartners = (items = []) => {
  const seen = new Set();
  return items.filter((partner) => {
    const key = normalizePartnerName(partner?.name ?? '');
    if (!key || seen.has(key)) return false;
    seen.add(key);
    return true;
  });
};

const partners = uniquePartners([
  ...hostPartners.map((partner) => ({
    name: partner.name,
    src: partner.logo ? `/buwatv/uploads/partners/hosts/${partner.logo}` : ''
  })),
  ...communityPartners.map((partner) => ({
    name: partner.name,
    src: partner.logo ? `/buwatv/uploads/partners/non-hosts/${partner.logo}` : ''
  }))
]).filter((partner) => partner.name && partner.src);

const partnerCount = partners.length;
---

<BaseLayout title={title} description={description}>
  <section class="hero">
    <div class="container">
      <h1>Our Partners</h1>
      <p class="subtitle">Local brands we’re proud to work with across the community.</p>
      <a href="/contact-us/" class="btn btn-cta">
        <i class="fa-solid fa-paper-plane"></i> Get In Touch
      </a>
    </div>
  </section>

  <section class="partners-section">
    <div class="container">
      <h2>We appreciate our partners</h2>
      <p class="intro">Here's a snapshot of some of the local businesses that work hard every day to gain community trust and strengthen the local scene.</p>
    </div>
    <div class="carousel-wrapper">
      <div
        class="carousel-track"
        style={`--carousel-duration: ${partnerCount * 1.2}s`}
      >
        {partners.map(partner => (
          <div class="carousel-item">
            <img src={partner.src} alt={partner.name} loading="eager" decoding="async" />
          </div>
        ))}
        {partners.map(partner => (
          <div class="carousel-item">
            <img src={partner.src} alt={partner.name} loading="eager" decoding="async" />
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="testimonials" id="testimonials">
    <div class="container">
      <h2>What Our Partners Are Saying</h2>
      <p class="testimonials-subtitle">Don't just take our word for it.</p>
      <div class="testimonial-grid">
        <div class="testimonial-card">
          <div class="stars">
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
          </div>
          <p class="testimonial-text">"Incredible service and team. Buck and Waddy have nailed it when it comes to business-to-business advertising that is visually appealing, fresh and fun. This has been a great way to advertise events, news and company info. It's easy to tell they love and support the small business community."</p>
          <div class="testimonial-author">
            <span class="author-name">Christina Nelson</span>
            <span class="author-company">The Greater CWC Chamber of Commerce</span>
          </div>
        </div>
        <div class="testimonial-card">
          <div class="stars">
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
          </div>
          <p class="testimonial-text">"Buwa Digital is the real deal when it comes to helping local businesses grow in today's digital world. Their indoor digital billboards are a game-changer for visibility. What I appreciate most is their passion for empowering small businesses here in Columbia. It feels less like hiring a vendor and more like gaining a partner who's invested in your success."</p>
          <div class="testimonial-author">
            <span class="author-name">David Medley</span>
            <span class="author-company">Better Homes and Gardens Real Estate Medley</span>
          </div>
        </div>
        <div class="testimonial-card">
          <div class="stars">
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
          </div>
          <p class="testimonial-text">"Buwa Digital has been a tremendous help in improving my business's online presence. They made the process of setting up and optimizing my Google Business page simple and effective. Their team was responsive, professional, and delivered exactly what they promised. I've already noticed a difference in how clients are finding us online."</p>
          <div class="testimonial-author">
            <span class="author-name">Zach Coggins</span>
            <span class="author-company">Milestone Wealth Advisors</span>
          </div>
        </div>
      </div>
      <div class="google-attribution">
        <i class="fa-brands fa-google"></i> Reviews from Google
      </div>
    </div>
  </section>

  <section class="review">
    <div class="review-bg"></div>
    <div class="container">
      <h2>Write Us a Review</h2>
      <p>We'd love to hear about your experience working with us!</p>
      <a href="https://g.page/r/CaCY12nNkQppEBM/review" class="btn btn-cta" target="_blank" rel="noopener">Leave One Now</a>
    </div>
  </section>
</BaseLayout>

<style>
  .hero {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    padding: 3rem 2rem 4rem;
    text-align: center;
    color: white;
    position: relative;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      135deg,
      transparent,
      transparent 10px,
      rgba(255,255,255,0.02) 10px,
      rgba(255,255,255,0.02) 20px
    );
    pointer-events: none;
  }

  .hero .container {
    position: relative;
    z-index: 1;
  }

  .hero h1 {
    font-family: 'Inter', sans-serif;
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .hero .subtitle {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    color: rgba(255,255,255,0.9);
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .btn-cta {
    background: linear-gradient(180deg, #c42536 0%, #a01c2b 100%);
    color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .btn-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.35), 0 2px 4px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .partners-section {
    padding: 4rem 0;
    background: white;
    overflow: hidden;
    text-align: center;
  }

  .partners-section h2 {
    font-family: 'Inter', sans-serif;
    font-size: 2rem;
    color: #1a1a2e;
    margin-bottom: 1rem;
  }

  .partners-section .intro {
    max-width: 700px;
    margin: 0 auto 2rem;
    color: #4a5568;
    line-height: 1.7;
  }

  .carousel-wrapper {
    overflow: hidden;
    width: 100%;
  }

  .carousel-track {
    display: flex;
    width: max-content;
    --loop-width: 50%;
    animation: smoothScroll var(--carousel-duration, 30s) linear infinite;
    will-change: transform;
  }

  .carousel-track:hover {
    animation-play-state: paused;
  }

  @keyframes smoothScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(calc(-1 * var(--loop-width))); }
  }

  .carousel-item {
    flex: 0 0 320px;
    height: 220px;
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
  }

  .carousel-item img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    filter: grayscale(20%);
    opacity: 0.85;
    transition: all 0.3s ease;
  }

  .carousel-item img:hover {
    filter: grayscale(0%);
    opacity: 1;
    transform: scale(1.05);
  }

  .testimonials {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    text-align: center;
    padding: 4rem 0;
  }

  .testimonials h2 {
    color: white;
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .testimonials-subtitle {
    color: rgba(255,255,255,0.85);
    margin-bottom: 3rem;
    font-size: 1.1rem;
  }

  .testimonial-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .testimonial-card {
    background: #f8f9fa;
    padding: 2rem;
    border-radius: 12px;
    text-align: left;
    box-shadow:
      0 2px 4px rgba(0,0,0,0.04),
      0 8px 24px rgba(0,0,0,0.08);
    border: 1px solid rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .testimonial-card:hover {
    transform: translateY(-4px);
    box-shadow:
      0 4px 8px rgba(0,0,0,0.06),
      0 12px 32px rgba(0,0,0,0.12);
  }

  .testimonial-card .stars {
    margin-bottom: 1rem;
  }

  .testimonial-card .stars i {
    color: #f4b400;
    font-size: 1rem;
    margin-right: 2px;
  }

  .testimonial-text {
    color: #444;
    font-size: 0.95rem;
    line-height: 1.7;
    flex-grow: 1;
    margin-bottom: 1.5rem;
    font-style: italic;
  }

  .testimonial-author {
    border-top: 1px solid #e0e0e0;
    padding-top: 1rem;
  }

  .author-name {
    display: block;
    font-weight: 600;
    color: #1a1a2e;
    margin-bottom: 0.25rem;
  }

  .author-company {
    display: block;
    font-size: 0.85rem;
    color: #666;
  }

  .google-attribution {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255,255,255,0.7);
    font-size: 0.9rem;
    margin-top: 1rem;
  }

  .google-attribution i {
    color: #4285f4;
    font-size: 1.1rem;
  }

  .review {
    position: relative;
    overflow: hidden;
    background: #17246c;
    color: white;
    text-align: center;
    padding: 4rem 0;
  }

  .review-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      linear-gradient(135deg, transparent 40%, rgba(10, 16, 48, 0.6) 40%, rgba(10, 16, 48, 0.6) 45%, transparent 45%),
      linear-gradient(135deg, transparent 55%, rgba(10, 16, 48, 0.5) 55%, rgba(10, 16, 48, 0.5) 60%, transparent 60%),
      linear-gradient(135deg, transparent 70%, rgba(10, 16, 48, 0.4) 70%, rgba(10, 16, 48, 0.4) 75%, transparent 75%),
      linear-gradient(135deg, transparent 20%, rgba(30, 50, 120, 0.3) 20%, rgba(30, 50, 120, 0.3) 25%, transparent 25%);
    pointer-events: none;
  }

  .review .container {
    position: relative;
    z-index: 1;
  }

  .review h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
  }

  .review p {
    opacity: 0.9;
    margin-bottom: 1.5rem;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  @media (max-width: 768px) {
    .hero h1 {
      font-size: 2rem;
    }

    .carousel-item {
      flex: 0 0 220px;
      height: 170px;
    }

    .testimonial-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const track = document.querySelector('.carousel-track');
    if (!track) return;

    const updateLoopWidth = () => {
      const items = track.querySelectorAll('.carousel-item');
      const totalItems = items.length;
      const half = Math.floor(totalItems / 2);
      if (half === 0) return;
      const width = Array.from(items)
        .slice(0, half)
        .reduce((sum, item) => sum + item.getBoundingClientRect().width, 0);
      if (width > 0) {
        track.style.setProperty('--loop-width', `${width}px`);
      }
    };

    const images = track.querySelectorAll('img');
    let loadedCount = 0;

    const checkLoaded = () => {
      loadedCount++;
      if (loadedCount >= images.length) {
        updateLoopWidth();
      }
    };

    images.forEach((img) => {
      if (img.complete) {
        checkLoaded();
      } else {
        img.addEventListener('load', checkLoaded);
        img.addEventListener('error', checkLoaded);
      }
    });

    // Fallback in case images are slow to load.
    setTimeout(updateLoopWidth, 1500);
  });
</script>
